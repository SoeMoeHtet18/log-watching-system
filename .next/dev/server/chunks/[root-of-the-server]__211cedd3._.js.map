{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Personal/.smh/.projects/log-watching-system/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, type Db } from \"mongodb\"\n\nif (!process.env.MONGODB_URI) {\n  throw new Error(\"Please add your MongoDB URI to .env.local\")\n}\n\nconst uri = process.env.MONGODB_URI\nconst options = {}\n\nlet client: MongoClient\nlet clientPromise: Promise<MongoClient>\n\nif (process.env.NODE_ENV === \"development\") {\n  const globalWithMongo = global as typeof globalThis & {\n    _mongoClientPromise?: Promise<MongoClient>\n  }\n\n  if (!globalWithMongo._mongoClientPromise) {\n    client = new MongoClient(uri, options)\n    globalWithMongo._mongoClientPromise = client.connect()\n  }\n  clientPromise = globalWithMongo._mongoClientPromise\n} else {\n  client = new MongoClient(uri, options)\n  clientPromise = client.connect()\n}\n\nexport default clientPromise\n\nexport async function getDatabase(): Promise<Db> {\n  const client = await clientPromise\n  return client.db(process.env.MONGODB_DB_NAME || \"logs_db\")\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,MAAM;IAIN,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAKe;AAER,eAAe;IACpB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC,QAAQ,GAAG,CAAC,eAAe,IAAI;AAClD"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Personal/.smh/.projects/log-watching-system/app/api/logs/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { getDatabase } from \"@/lib/mongodb\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const page = Number.parseInt(searchParams.get(\"page\") || \"1\")\n    const perPage = Number.parseInt(searchParams.get(\"per_page\") || \"20\")\n    const apiName = searchParams.get(\"api_name\") || \"\"\n    const method = searchParams.get(\"method\") || \"\"\n    const domain = searchParams.get(\"domain\") || \"\"\n    const searchTerm = searchParams.get(\"search\") || \"\"\n\n    // Build filter query\n    const filter: any = {}\n\n    // Add specific filters\n    if (apiName) {\n      filter.api_name = { $regex: apiName, $options: \"i\" }\n    }\n    if (method) {\n      filter.method = method\n    }\n    if (domain) {\n      filter.domain = { $regex: domain, $options: \"i\" }\n    }\n\n    // Add search term filter if provided\n    if (searchTerm) {\n      const searchRegex = { $regex: searchTerm, $options: \"i\" }\n      \n      filter.$or = [\n        { api_name: searchRegex },\n        { url: searchRegex },\n        { request_payload_text: searchRegex },\n        { response_text: searchRegex }\n      ]\n    }\n\n    const db = await getDatabase()\n    const collection = db.collection(\"logs\")\n\n    // Get total count\n    const total = await collection.countDocuments(filter)\n\n    // Get counts for different statuses\n    const successCount = await collection.countDocuments({ ...filter, status: { $in: [\"success\", \"200\", \"201\"] } })\n    const errorCount = await collection.countDocuments({\n      ...filter,\n      $or: [\n        { status: { $regex: \"failed\", $options: \"i\" } },\n        { status: { $gte: 400, $lt: 600 } }\n      ]\n    })\n    const pendingCount = total - successCount - errorCount\n\n    // Get paginated logs\n    const logs = await collection\n      .find(filter)\n      .sort({ created_at: -1 })\n      .skip((page - 1) * perPage)\n      .limit(perPage)\n      .toArray()\n\n    // Transform MongoDB documents to match the Log interface\n    const transformedLogs = logs.map((log) => ({\n      id: log._id.toString(),\n      domain: log.domain || null,\n      api_name: log.api_name || null,\n      method: log.method || null,\n      url: log.url || null,\n      request_payload: log.request_payload || null,\n      response: log.response || null,\n      status: log.status || null,\n      error_message: log.error_message || null,\n      created_at: log.created_at || log.createdAt || new Date().toISOString(),\n      updated_at: log.updated_at || log.updatedAt || new Date().toISOString(),\n    }))\n\n    return NextResponse.json({\n      data: transformedLogs,\n      meta: {\n        current_page: page,\n        per_page: perPage,\n        total,\n        last_page: Math.ceil(total / perPage) || 1,\n        stats: {\n          total,\n          success: successCount,\n          errors: errorCount,\n          pending: pendingCount\n        }\n      },\n    })\n  } catch (error) {\n    console.error(\"[v0] Error fetching logs:\", error)\n    return NextResponse.json({ error: \"Failed to fetch logs from database\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,OAAO,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,WAAW;QACzD,MAAM,UAAU,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,eAAe;QAChE,MAAM,UAAU,aAAa,GAAG,CAAC,eAAe;QAChD,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAC7C,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAC7C,MAAM,aAAa,aAAa,GAAG,CAAC,aAAa;QAEjD,qBAAqB;QACrB,MAAM,SAAc,CAAC;QAErB,uBAAuB;QACvB,IAAI,SAAS;YACX,OAAO,QAAQ,GAAG;gBAAE,QAAQ;gBAAS,UAAU;YAAI;QACrD;QACA,IAAI,QAAQ;YACV,OAAO,MAAM,GAAG;QAClB;QACA,IAAI,QAAQ;YACV,OAAO,MAAM,GAAG;gBAAE,QAAQ;gBAAQ,UAAU;YAAI;QAClD;QAEA,qCAAqC;QACrC,IAAI,YAAY;YACd,MAAM,cAAc;gBAAE,QAAQ;gBAAY,UAAU;YAAI;YAExD,OAAO,GAAG,GAAG;gBACX;oBAAE,UAAU;gBAAY;gBACxB;oBAAE,KAAK;gBAAY;gBACnB;oBAAE,sBAAsB;gBAAY;gBACpC;oBAAE,eAAe;gBAAY;aAC9B;QACH;QAEA,MAAM,KAAK,MAAM,IAAA,+HAAW;QAC5B,MAAM,aAAa,GAAG,UAAU,CAAC;QAEjC,kBAAkB;QAClB,MAAM,QAAQ,MAAM,WAAW,cAAc,CAAC;QAE9C,oCAAoC;QACpC,MAAM,eAAe,MAAM,WAAW,cAAc,CAAC;YAAE,GAAG,MAAM;YAAE,QAAQ;gBAAE,KAAK;oBAAC;oBAAW;oBAAO;iBAAM;YAAC;QAAE;QAC7G,MAAM,aAAa,MAAM,WAAW,cAAc,CAAC;YACjD,GAAG,MAAM;YACT,KAAK;gBACH;oBAAE,QAAQ;wBAAE,QAAQ;wBAAU,UAAU;oBAAI;gBAAE;gBAC9C;oBAAE,QAAQ;wBAAE,MAAM;wBAAK,KAAK;oBAAI;gBAAE;aACnC;QACH;QACA,MAAM,eAAe,QAAQ,eAAe;QAE5C,qBAAqB;QACrB,MAAM,OAAO,MAAM,WAChB,IAAI,CAAC,QACL,IAAI,CAAC;YAAE,YAAY,CAAC;QAAE,GACtB,IAAI,CAAC,CAAC,OAAO,CAAC,IAAI,SAClB,KAAK,CAAC,SACN,OAAO;QAEV,yDAAyD;QACzD,MAAM,kBAAkB,KAAK,GAAG,CAAC,CAAC,MAAQ,CAAC;gBACzC,IAAI,IAAI,GAAG,CAAC,QAAQ;gBACpB,QAAQ,IAAI,MAAM,IAAI;gBACtB,UAAU,IAAI,QAAQ,IAAI;gBAC1B,QAAQ,IAAI,MAAM,IAAI;gBACtB,KAAK,IAAI,GAAG,IAAI;gBAChB,iBAAiB,IAAI,eAAe,IAAI;gBACxC,UAAU,IAAI,QAAQ,IAAI;gBAC1B,QAAQ,IAAI,MAAM,IAAI;gBACtB,eAAe,IAAI,aAAa,IAAI;gBACpC,YAAY,IAAI,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,OAAO,WAAW;gBACrE,YAAY,IAAI,UAAU,IAAI,IAAI,SAAS,IAAI,IAAI,OAAO,WAAW;YACvE,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM;YACN,MAAM;gBACJ,cAAc;gBACd,UAAU;gBACV;gBACA,WAAW,KAAK,IAAI,CAAC,QAAQ,YAAY;gBACzC,OAAO;oBACL;oBACA,SAAS;oBACT,QAAQ;oBACR,SAAS;gBACX;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqC,GAAG;YAAE,QAAQ;QAAI;IAC1F;AACF"}}]
}